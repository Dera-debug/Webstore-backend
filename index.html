<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap and Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://unpkg.com/vue@2.7.8/dist/vue.js"></script>
    <script src="products.js"></script>

    <title>Lesson App</title>
</head>

<body class="bg-light text-dark">
    <div id="app" class="container my-5">

        <!-- Header -->
        <header class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="text-primary">{{ sitename }}</h1>
            <button class="btn btn-primary" v-on:click="showCheckout">
                <span class="me-2">{{ itemsInTheCart }}</span>
                <i class="fa-solid fa-cart-shopping"></i> Checkout
            </button>
        </header>


        
        <!-- Main Content -->
        <main>
            <!-- Product View -->
            <div v-if="showProduct" class="row g-4">
                <div v-for="product in sortedProducts" :key="product.id" class="col-sm-12 col-md-6 col-lg-3">
                    <div class="card h-100 p-3">
                        <!-- Product Image -->
                        <img :src="product.image" class="card-img-top img-fluid" style="height: 200px; object-fit: cover;">
                        
                        <!-- Product Details -->
                        <div class="card-body">
                            <h5 class="card-title text-primary">{{ product.title }}</h5>
                            <p class="card-text text-secondary">{{ product.description }}</p>
                            <p><strong>Price:</strong> ${{ product.price }}</p>

                            <!-- Add to Cart Button -->
                            <button class="btn btn-warning w-100 mt-3" v-if="canAddToTheCart(product)" 
                                    v-on:click="addItemToTheCart(product)">
                                Add to Cart
                            </button>
                            <button class="btn btn-secondary w-100 mt-3" v-else disabled>
                                Add to Cart (Out of Stock)
                            </button>
                        </div>
                        
                        <span v-if="itemsLeft(product) === 0">Seats filled ! ></span>
                        <span v-else-if="itemsLeft(product) < 5">Only {{itemsLeft(product)}} spaces left! ></span>
                        <span v-else>Book your seat now!</span>

                        <!-- Rating -->
                        <div class="card-footer text-center">
                            <span v-for="n in product.rating" class="text-warning">★</span>
                            <span v-for="n in 5 - product.rating" class="text-muted">☆</span>
                        </div>
                    </div>
                </div>
            </div>
       
   


            <!-- Checkout Page -->
            <div v-else>
                <h1 class="text-primary">Welcome to the Checkout page</h1>
                <form @submit.prevent="submitCheckOutForm">
                    <div class="mb-3">
                        <label for="name" class="form-label"><strong>Name:</strong></label>
                        <input type="text" v-model.trim="order.name" class="form-control" id="name">
                    </div>
                    <div class="mb-3">
                        <label for="surname" class="form-label"><strong>Surname:</strong></label>
                        <input type="text" v-model.trim="order.surname" class="form-control" id="surname">
                    </div>
                    <div class="mb-3">
                        <label for="address" class="form-label"><strong>Address:</strong></label>
                        <input type="text" v-model.trim="order.Address" class="form-control" id="address">
                    </div>
                    <div class="mb-3">
                        <label for="state" class="form-label"><strong>State:</strong></label>
                        <select v-model="order.State" class="form-select" id="state">
                            <option disabled>Select State</option>
                            <option v-for="(state, key) in states" :value="state">{{ key }}</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="zip" class="form-label"><strong>Zip/Postal Code:</strong></label>
                        <input type="number" v-model.number="order.Zip" class="form-control" id="zip">
                    </div>
                    <div class="form-check mb-3">
                        <input type="checkbox" id="gift" class="form-check-input" v-model="order.gift">
                        <label class="form-check-label" for="gift">Send as a gift?</label>
                    </div>
                    <div class="mb-3">
                        <input type="radio" id="home" value="Home" v-model="order.method" class="form-check-input">
                        <label class="form-check-label" for="home">Home</label>
                        <input type="radio" id="business" value="Business" v-model="order.method"
                            class="form-check-input ms-3">
                        <label class="form-check-label" for="business">Business</label>
                    </div>
                    <button type="submit" class="btn btn-primary">Place Order</button>
                </form>
            </div>
        </div>
    </main>
    

    <script src="https://unpkg.com/vue@2.7.8/dist/vue.js"></script>
    <script>
        let webstore = new Vue({
            el: "#app",
            data: {
                sitename: "My Lesson App",
                showProduct: true,
                // product: {
                //     id: 1001,
                //     title: "Maths Lesson",
                //     description: "A 25 pound bag of irresistible, organic goodness for your cat.",
                //     price: 2000,
                //     image: "https://images.unsplash.com/photo-1509869175650-a1d97972541a?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
                //     availableInventory: 10,
                //     rating:3
                // },
                products: products,
                
                cart: [],
                order: {
                    name: "",
                    surname: "",
                    Address: "",
                    State: "",
                    Zip: "",
                    gift: "Do not send as a gift",
                    method: "Home"
                },
                states: {
                    AL: "Alabama",
                    AR: "Arizona",
                    CA: "California",
                    NV: "Nevada"
                }
            },
            methods: {
                showCheckout() {
                    this.showProduct = !this.showProduct;
                },
                addItemToTheCart(product) {
                    this.cart.push(product.id);
                },
                submitCheckOutForm() {
                    alert("Congratulations, order submitted :)");
                },
                canAddToTheCart(product) {
                    return product.availableInventory > this.cartCount(product.id);
                },
                cartCount(id) {
                    let count=0;
                    for(let i=0; i< this.cart.length; i++){
                        if (this.cart[i] === id) {
                            count++;
                        }
                    }
                    return count;
                },
                itemsLeft(product) {
                    return product.availableInventory - this.cartCount(product.id);
                }
            },
            computed: {
                itemsInTheCart() {
                    return this.cart.length || "";
                },

              sortedProducts(){
                function compare(a,b){
                    if (a.price > b.price) return -1;
                    if (a.price < b.price) return 1;
                    return 0;
                }

                return this.products.sort (compare);
              }
               
            }
        });
    </script>
</body>

</html>